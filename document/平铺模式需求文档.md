### 1.1 背景

本项目旨在现有的 UniApp + AI 斗地主游戏基础上，开发一套专为视障（全盲）用户设计的操作界面。该模式利用“空间记忆”原理，摒弃传统视觉美感，优先考虑触控效率、误触防止及听觉反馈。

### 1.2 目标

- 提供一个固定的、网格化的手牌布局，确保用户能通过肌肉记忆快速定位牌面。
- 解决手牌过多时的触控难题，采用“堆叠+循环点选”的交互逻辑。
- 深度集成百度 TTS（语音合成）和 ASR（语音识别），实现“零视觉”流畅对战。

------

## 2. 界面布局规范 (UI Specifications)

### 2.1 视口划分 (Viewport Partition)

屏幕垂直方向划分为三个固定区域，禁止滚动（防止破坏空间定位）：

1. 顶部信息区 (10% - 15% 高度)
   - **内容**：显示/播报当前地主、本轮出牌倒计时、其他玩家剩余牌数。
   - **交互**：点击该区域触发 TTS 播报当前全局战况。
2. 中部交互区 (25% - 30% 高度)
   - **出牌历史**：用特大号字体/高对比度显示上家出的牌。
   - **语音指令按钮**：位于屏幕正中或易触达位置的超大物理触控区（长按说话）。
   - **模式切换**：右上角保留小按钮，用于切换“平铺/竖向/正常”模式。
3. 底部手牌区 (55% - 60% 高度) - 核心功能区
   - 采用 CSS Grid 或 Flex Column 布局，分为固定的三行。

### 2.2 三行手牌平铺布局 (Flat Layout Matrix)

**核心原则**：位置固定（Fixed Position）。即使手中没有该点数的牌，该位置也应保留（作为不可点击的占位符/空槽），确保肌肉记忆不偏移。

- **第一行：高分值区 (High Value Row)**

  - **包含牌面**：10, J, Q, K
  - **布局**：4 等分宽度 (25% Width)。
  - **触感设计**：按钮宽大，易于触摸。

- **第二行：数字顺子区 (Numeric Row)**

  - **包含牌面**：3, 4, 5, 6, 7, 8, 9
  - **布局**：7 等分宽度 (~14.2% Width)。
  - **触感设计**：**物理宽度明显窄于上下两行**。用户触摸时可通过宽度的变化感知当前处于数字行，起到触觉导航作用。

- **第三行：强权控制区 (Power Row)**

  - **包含牌面**：A, 2, 小王, 大王

  - **布局**：4 等分宽度 (25% Width)。

  - 特殊处理

    ：

    - “A”和“2”位于左侧。
    - “小王”和“大王”位于右侧，建议给予特殊的背景纹理或边框触感（软件模拟），强调其重要性。

------

## 3. 交互逻辑 (Interaction Logic)

### 3.1 堆叠显示与状态 (Stacking & States)

界面不平铺展示 17/20 张牌，而是将相同点数的牌折叠在同一个“坑位”中。每个坑位有三种状态：

1. 空状态 (Empty)
   - **定义**：手牌中无此点数。
   - **表现**：视觉变暗/灰色。
   - **触控反馈**：短促低沉提示音或语音播报“无”。
2. 持有状态 (Owned)
   - **定义**：手牌中有此点数（如 3 张 5），但未选中。
   - **表现**：高对比度亮色，显示持有数量角标。
   - **触控反馈**：语音播报“三张 5”。
3. 选中状态 (Selected)
   - **定义**：用户意图打出该牌，且已选定具体数量。
   - **表现**：颜色反转/高亮边框。
   - **触控反馈**：语音播报“已选 2 张 5”。

### 3.2 循环点选机制 (Cycle Selection)

解决“拆牌”问题的核心逻辑：

- 单击/双击 (Tap)

  ：

  - **逻辑**：在 `0 -> 1 -> ... -> 最大持有数 -> 0` 之间循环切换。

  - 示例

    ：手中有 4 张 3。

    - 初始：选中 0。
    - 点击 1 次：选中 1 张（播报“已选一张 3”）。
    - 点击 2 次：选中 2 张（播报“已选两张 3”）。
    - ...
    - 点击 5 次：重置为 0（播报“取消选择 3”）。

- 长按 (Long Press)

  ：

  - **逻辑**：直接全选该点数的所有牌。
  - **反馈**：强震动 + 播报“已全选四张 3，炸弹”。

### 3.3 手势盲操作

- **滑动探索 (Explore by Touch)**：手指在屏幕上滑动时，实时触发经过区域的 TTS 简短播报（如“5”、“6”、“7”），帮助用户定位。

------

## 4. 功能需求 (Functional Requirements)

### 4.1 数据映射 (Data Mapping)

前端需构建一个 ViewModel，将后端传来的线性手牌数组（Array）映射为固定的 Map 结构：

```
<JAVASCRIPT>








// 需实现的逻辑结构

LayoutMap = {

  row1: [10, 11(J), 12(Q), 13(K)],

  row2: [3, 4, 5, 6, 7, 8, 9],

  row3: [14(A), 15(2), 16(小王), 17(大王)]

}
```

*注：地主（20张）与农民（17张）的区别仅体现在每个坑位的 `count` 属性上，布局结构完全一致。*

### 4.2 智能辅助 (Smart Assist)

- **连选辅助**：利用 `cardLogic.js`，当用户连续选中“3”、“4”且意图明显时，点击“5”可尝试自动触发顺子提示（可选高阶功能）。

### 4.3 语音与 AI 集成

- 输入

  ：通过中部区域的录音按钮，调用

   

  ```
  recorder-core
  ```

   

  和百度 ASR。

  - 识别指令：“拆一张 3”、“顺子 3 到 7”、“大王压死”。
  - 解析逻辑：根据 ASR 文本结果，自动操作 ViewModel 中的 `selectedCount`。

- **输出**：所有状态变更必须通过 `baiduAuth.js` 触发 TTS。

------

## 5. 样式与无障碍规范 (Style & A11y)

- 配色 (Color Scheme)

  ：

  - 必须使用 **WCAG 2.1 AAA** 标准的高对比度配色（如黑底黄字，或深蓝底白字）。
  - 避免使用单纯的颜色区分状态，必须辅以文字说明或形状变化。

- 字体 (Typography)

  ：

  - 牌面数字字号最大化。
  - 避免使用花哨的艺术字体，使用无衬线（Sans-serif）字体以提高清晰度。

- 震动反馈 (Haptics)

  ：

  - 触摸有牌区域：轻微震动 (`uni.vibrateShort`)。
  - 选中/确认：中等震动。
  - 触摸无牌区域：无震动或不同频率震动。

------

## 6. 开发注意事项

1. **性能优化**：由于滑动探索会频繁触发事件，需对 TTS 调用进行**防抖 (Debounce)** 处理，避免语音播报重叠混乱。
2. **兼容性**：预留“竖向模式”和“正常模式”的代码插槽，但当前阶段优先实现本平铺模式。
3. **测试重点**：必须在真机开启 TalkBack (Android) 或 VoiceOver (iOS) 环境下进行测试，确保原生读屏软件与内置 TTS 不冲突（建议接管模式）。